< !DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
        <title>NextUp · Test</title>
        <?!= include('Styles'); ?>
        <style>
            .container {
                max - width: 900px;
                margin: 22px auto;
                padding: 0 16px;
            }

            .card {
                background: #fff;
                border-radius: 12px;
                padding: 16px;
                box-shadow: 0 6px 16px rgba(0, 0, 0, .06);
                margin-bottom: 16px;
            }

            .checks li {
                display: flex;
                align-items: flex-start;
                gap: 8px;
                margin: 8px 0;
            }

            .ok {
                color: #0a7a2f;
                font-weight: 800;
            }

            .bad {
                color: #b3261e;
                font-weight: 800;
            }

            pre {
                background: #0f172a;
                color: #e9eef5;
                padding: 12px;
                border-radius: 10px;
                overflow: auto;
                font-size: .9rem;
            }

            .btn {
                padding: 12px 16px;
                border-radius: 12px;
                border: 0;
                background: #0f766e;
                color: #fff;
                font-weight: 700;
            }

            .muted {
                opacity: .7;
            }
        </style>
    </head>

    <body>
        <main class="container">
            <h1>Verification Suite</h1>
            <p class="muted">Creates a disposable event, verifies links, QR, and bundles. One click.</p>

            <section class="card">
                <button id="btnRun" class="btn">Run Full Verification</button>
                <label style="margin-left:8px;">
                    <input type="checkbox" id="keepChk" /> Keep test event/workbook for inspection
                </label>
                <div id="status" class="muted" style="margin-top:10px;">Idle</div>
            </section>

            <section class="card" id="resultCard" style="display:none;">
                <h2>Results</h2>
                <ul id="checks" class="checks"></ul>

                <h3>Artifacts</h3>
                <div id="artifacts"></div>

                <h3>Raw (for debugging)</h3>
                <pre id="raw"></pre>
            </section>
        </main>

        <div id="toast"></div>

        <script>
            function toast(msg, type) { const t = document.getElementById('toast'); t.textContent = msg; t.className = type === 'error' ? 'error show' : 'show'; setTimeout(() => t.classList.remove('show'), 2600); }

            async function run() {
                document.getElementById('status').textContent = 'Running…';
                document.getElementById('resultCard').style.display = 'none';
                const keep = document.getElementById('keepChk').checked;

                const res = await new Promise(resolve => {
                    google.script.run.withSuccessHandler(resolve).withFailureHandler(err => resolve({ ok: false, error: String(err) })).runVerificationSuite({ keep: keep });
                });

                document.getElementById('resultCard').style.display = '';
                document.getElementById('raw').textContent = JSON.stringify(res, null, 2);

                const ul = document.getElementById('checks'); ul.innerHTML = '';
                const checks = res.checks || [];
                checks.forEach(c => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="${c.ok ? 'ok' : 'bad'}">${c.ok ? '✓' : '✗'}</span> ${c.name}`;
                    ul.appendChild(li);
                });

                // Artifacts: show handy links if present
                const a = document.getElementById('artifacts'); a.innerHTML = '';
                function link(label, url) {
                    if (!url) return;
                    const el = document.createElement('div');
                    el.innerHTML = `<a href="${url}" target="_blank" rel="noopener">${label}</a>`;
                    a.appendChild(el);
                }
                try {
                    link('Workbook', res.created && res.created.eventSpreadsheetUrl);
                    link('Public Page', res.displayBundle && res.displayBundle.publicUrl);
                    link('Poster Page', res.displayBundle && res.displayBundle.posterPageUrl);
                    link('Admin (this app)', location.href.replace(/p=Test/, 'p=Admin'));
                } catch (_) { }

                document.getElementById('status').textContent = res.ok ? 'All checks passed' : 'Some checks failed';
                toast(res.ok ? 'All checks passed' : 'Some checks failed', res.ok ? 'success' : 'error');
            }

            document.getElementById('btnRun').addEventListener('click', run);
            // Auto-run on load for true one-click experience from bookmark
            document.addEventListener('DOMContentLoaded', run);
        </script>
    </body>

    </html>
